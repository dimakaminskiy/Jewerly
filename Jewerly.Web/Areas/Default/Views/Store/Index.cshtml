@using Jewerly.Web.Models
@using Jewerly.Web.Utils
@model Jewerly.Web.Models.StoreViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Default/Views/Shared/DefaultLayout.cshtml";
}


    <div class="col-sm-4 col-md-3">

        @Html.Partial("_SiteNavigationMenu", Model.MenuCategories)

    </div> <!--левая часть End--->

    <div class="col-sm-8 col-md-9">

        <div class="row text-center product-filter shadow mgo">
            <div class="col-sm-6">

                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Сортировка
                        <span class="caret"></span>
                    </button>
                    @Html.SortOptions(Model.ProductSortModel, Model.CurentCategoryId, Model.CurentCategorySeoName)
                </div>
                </div>
            <div class="col-sm-6">

                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="Сумма 179,99">
                        <div id="exchange">
                            <span>Валюта</span> /
                            <span>@Model.Currencies.CurrentCurrency.CurrencyCode</span>
                        </div>
                    </button>


                  
                    <div class="dropdown-menu popover popover-content">
                        <div>
                            <div>Выберите валюту</div>

                            <form id="form-currency" action="@Url.Action("Index")" method="POST">
                                <input class="hidden" name="CurrencyId" id="CurrencyId" value="@Model.Currencies.CurrentCurrencyId" type="text"/>
                            </form>
                             @foreach (var item in Model.Currencies.Currencies)
                                {
                                    <input class="btn btn-default btn-md currency"
                                           data-currency="@item.CurrencyId " value="@item.CurrencyCode" type="button"/>
                                }

                            <script>
                                $('.currency').click(function () {
                                    var t = $(this).attr("data-currency");
                                    $("#CurrencyId").val(t);
                                    $("#form-currency").submit();
                                });
                            </script>
                          </div>
                    </div>
                    </div>
                </div>
        </div>

        <div class="row text-center mgo">

            @{
                int count = 0;
            }

            @foreach (var item in Model.Products.List)
            {
                <div class="col-md-3 col-xs-6">
                    <div class="product-wrapper sale">
                        <div class="product-image">
                            @if (item.Discount != 0)
                            {
                                <div class="discount-img"></div>
                                <div class="discount-nm"><span>@item.Discount</span>%<br/>скидка
                                </div>
                            }
                            <img class="img-responsive" src="@item.Picture.Preview()" title="@item.Name" alt="@item.Name"/>
                        </div>
                        <div class="product-info text-center">
                            <a href="@Url.Action("Details", new {id = item.Id, name = item.SeoName})">@item.FullName </a>
                            <div class="price">
                                @item.PriceString @Model.Currencies.CurrentCurrency.CurrencyCode
                            </div>
                            <button class="btn btn-default btn-sm" type="button" data-toggle="modal" data-target="#myAlert">Купить</button>
                        </div>
                    </div>
                </div>


                count++;

                if (count == 2)
                {
                    <div class="clearfix visible-xs"></div>
                }
                else if (count == 4)
                {
                    count = 0;
                    <div class="clearfix visible-md"></div>
                    <div class="clearfix visible-xs"></div>

                }

            }



        </div>

        <div class="text-center">
           
            @if (Model.Products.CountPage > 1)
            {
                @Html.PageLinks(Model.Products.PageNo, Model.Products.CountPage, x => Url.Action("Index", "Store",
                        new
                        {
                            name = Model.CurentCategorySeoName,
                            id = Model.CurentCategoryId,
                            sort=Model.CurentSort,
                            page = x
                        }))
            }


        </div>
        
    </div>
